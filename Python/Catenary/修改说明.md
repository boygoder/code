## 修改说明

本次修改主要是为了解决两个问题：

1. 部分曲线拟合错误。
2. 实现将断裂缆绳连接的算法。



## 部分曲线拟合错误

在尝试拟合样例图片时，发现无法正确判别缆绳数量。在打印出像素矩阵后发现，像素矩阵中并不是非0即1的二值图，而应该称为灰度图，也就是白色像素点处是浮点数。那么，**修改方法是在判断缆绳数量之前，将非0的像素点处设为1**。这样就保证了样本点处为1，背景色处为0。

进行上述修改之后，再次对样例图片拟合，大部分图片拟合不错。仍然有几张拟合效果不好，如下：

![第19张](./badfit/19.png)![](./badfit/fit/19_fit.png)


![第23张](./badfit/23.png)![](./badfit/fit/23_fit.png)

其中，第19张拟合不好的原因是：交点部分过长，导致某一条缆绳曲线被分为相距较远的两段。第23张拟合不好的原因是：两条缆绳相交处，正是一条缆绳的尾部与另一条缆绳的头部相连，很难将其识别为两条缆绳。

## 断点连接

- [x] 尝试：sobel边缘检测，提取曲线得边缘。后续没有用到。

- [x] 尝试：cv.findcontours，很接近效果了，可以把一段段的曲线分离出来。每个集合中存储一簇曲线的点，找出端点，我们希望连接端点间距离最近的曲线。（有可能会错连，如何限制端点间的距离？）

- [x] 尝试：如何辨别端点？看八邻域内的点，端点的话领域内只有一个点，计算梯度，然后向梯度方向延伸一段距离（以其为中心的矩阵范围内），如果遇到点的话，就连接起来。

- [x] 困难：无法正确识别端点，边缘检测得到的点过于密集，发现每个点的领域内至少有三个其他点。需要新的方法去检测端点或者优化边缘检测方法。

- [x] 端点检测：对于原图像每一个前景点，探测左上方四个点，探测右下方四个点，若没有前景点，则标记为端点，并区分左端点和右端点，但是端点相距很远时，无法将其连接。

  ![](../../../课程资料/研究生/王老师组会/缆绳/latex/neighbors.png)

- [ ] 断点连接问题：取出一段最长的部分，进行拟合，这里可以利用cv.findcontours将连通的曲线分离出来。将拟合出的曲线覆盖的地方（附近范围内），认作是需要连接的地方，将其抹去。对剩余的点，再次进行拟合。

- [ ] 拟合效果不好问题：交点过长、过短问题。1.临时解决方法：若原图像与拟合曲线的差别很大，更换初始的采样点，或许效果会好一点（这个方法只对部分情况有效，无法解决本质问题）。2.如果效果不好，把已经参与拟合的样本点去掉，不让其参与下一次拟合，对剩余的样本点再做拟合。

- [ ] 解决两个问题的思路：先对一部分曲线进行操作。